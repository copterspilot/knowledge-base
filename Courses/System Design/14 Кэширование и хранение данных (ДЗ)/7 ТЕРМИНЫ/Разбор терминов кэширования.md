#### **1. Cache Miss (Промах кэша)**
**Определение:**  
Ситуация, когда запрошенные данные отсутствуют в кэше и требуют загрузки из основного источника (БД, API, диска).  

**Причины:**  
- Данные никогда не кэшировались.  
- Кэш был очищен (инвалидация).  
- Истёк TTL (время жизни записи).  

**Последствия:**  
- Увеличение **latency** (задержки), так как система обращается к более медленному хранилищу.  
- Повышенная нагрузка на БД.  

**Пример:**  
```python
# Запрос к Redis (кэш)
data = cache.get("user:123")  # Возвращает None (промах)
if data is None:
    data = db.query("SELECT * FROM users WHERE id = 123")  # Чтение из БД
    cache.set("user:123", data, ttl=3600)  # Прогрев кэша
```

---

#### **2. Cache Hit (Попадание в кэш)**
**Определение:**  
Успешное нахождение запрошенных данных в кэше.  

**Преимущества:**  
- Минимальная **latency** (данные доступны мгновенно).  
- Снижение нагрузки на БД.  

**Пример:**  
```python
data = cache.get("user:123")  # Возвращает данные (попадание)
```

---

#### **3. Hit Ratio (Коэффициент попаданий)**
**Определение:**  
Отношение количества **попаданий** к общему числу запросов к кэшу. Выражается в процентах.  

**Формула:**  
```
Hit Ratio = (Cache Hits / (Cache Hits + Cache Misses)) * 100%
```

**Нормы:**  
- **> 90%** — отличный показатель.  
- **< 70%** — требуется оптимизация (например, увеличение размера кэша или настройка TTL).  

**Пример:**  
- Запросов: 1000.  
- Попаданий: 850.  
- Промахов: 150.  
- **Hit Ratio = (850 / 1000) * 100% = 85%**.  

---

#### **4. Горячий ключ (Hot Key)**
**Определение:**  
Ключ, который запрашивается **значительно чаще** других, создавая дисбаланс нагрузки.  

**Проблемы:**  
- Перегрузка одного узла кэша (например, в Redis Cluster).  
- Риск отказа сервиса.  

**Решение:**  
- **Шардинг ключа**:  
  ```python
  # Вместо "product:123" используем "product:123:shard1", "product:123:shard2"
  ```
- **Локальный кэш**: Кэшировать горячие ключи в памяти приложения (например, Guava Cache).  

**Пример:**  
- Ключ `trending:news` получает 10 000 запросов/сек, тогда как другие — 50 запросов/сек.  

---

#### **5. Прогрев кэша (Cache Warm-Up)**
**Определение:**  
Предварительное заполнение кэша данными **до** начала работы приложения.  

**Методы:**  
- **При старте системы**: Загрузка топ-1000 товаров из БД в Redis.  
- **Ленивая загрузка**: Данные кэшируются при первом запросе.  

**Пример:**  
```python
# При запуске сервиса
popular_products = db.query("SELECT * FROM products ORDER BY views DESC LIMIT 1000")
for product in popular_products:
    cache.set(f"product:{product.id}", product)
```

---

#### **6. Инвалидация кэша (Cache Invalidation)**
**Определение:**  
Принудительное удаление или обновление данных в кэше при их изменении в источнике.  

**Стратегии:**  
- **TTL (Time-To-Live)**: Автоматическое удаление через заданное время.  
- **Ручная инвалидация**:  
  ```python
  cache.delete("user:123")  # Удаление ключа при изменении данных пользователя
  ```
- **Публикация событий**: Например, через Kafka (уведомление об изменении данных).  

**Проблемы:**  
- **Устаревшие данные (stale data)**: Если инвалидация не синхронизирована с БД.  

---

### **Сводная таблица терминов**
| Термин           | Определение                                  | Пример проблемы               | Решение                     |
|------------------|---------------------------------------------|-------------------------------|-----------------------------|
| **Cache Miss**   | Данные не найдены в кэше                    | Увеличение нагрузки на БД     | Прогрев кэша, настройка TTL |
| **Cache Hit**    | Данные найдены в кэше                       | —                             | —                           |
| **Hit Ratio**    | % попаданий от общего числа запросов        | Низкий hit ratio (<70%)       | Увеличение размера кэша     |
| **Горячий ключ** | Ключ с аномально высокой частотой запросов  | Перегрузка узла кэша          | Шардинг, локальный кэш      |
| **Прогрев кэша** | Предзагрузка данных в кэш                   | Холодный старт приложения     | Фоновый процесс загрузки    |
| **Инвалидация**  | Удаление устаревших данных из кэша          | Stale data                    | TTL, события (Kafka)        |

---

### **Контрольные вопросы**
1. **Как повысить hit ratio?**  
   - Увеличить размер кэша.  
   - Оптимизировать TTL.  
   - Предзагружать популярные данные (warm-up).  

2. **Почему горячие ключи опасны для Redis Cluster?**  
   - Они создают нагрузку на один узел, а не распределяются равномерно.  

3. **Что хуже: cache miss или stale data?**  
   - Зависит от контекста:  
     - **Cache miss** — снижает производительность.  
     - **Stale data** — приводит к ошибкам в бизнес-логике (например, некорректный баланс счёта).  

Эти термины — основа проектирования эффективных систем кэширования. Понимание их поможет избежать типичных ошибок в high-load проектах. 🚀