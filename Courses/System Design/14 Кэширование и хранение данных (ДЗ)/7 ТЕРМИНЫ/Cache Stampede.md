### **Cache Stampede (–∞—Ç–∞–∫–∞ —Ç–æ–ª–ø—ã –Ω–∞ –∫—ç—à, "–∫—ç—à-—Å—Ç—ç–º–ø—ç–π–¥")**  

**Cache Stampede** ‚Äî —ç—Ç–æ –ø—Ä–æ–±–ª–µ–º–∞ –≤ –≤—ã—Å–æ–∫–æ–Ω–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö —Å–∏—Å—Ç–µ–º–∞—Ö, –∫–æ–≥–¥–∞ –ø—Ä–∏ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–º –∏—Å—Ç–µ—á–µ–Ω–∏–∏ —Å—Ä–æ–∫–∞ –∂–∏–∑–Ω–∏ –¥–∞–Ω–Ω—ã—Ö –≤ –∫—ç—à–µ (**cache miss**) –º–Ω–æ–∂–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤ –ø—ã—Ç–∞—é—Ç—Å—è –ø–µ—Ä–µ—Å—á–∏—Ç–∞—Ç—å —ç—Ç–∏ –¥–∞–Ω–Ω—ã–µ, —Å–æ–∑–¥–∞–≤–∞—è –ª–∞–≤–∏–Ω–æ–æ–±—Ä–∞–∑–Ω—É—é –Ω–∞–≥—Ä—É–∑–∫—É –Ω–∞ —Å–µ—Ä–≤–µ—Ä. –≠—Ç–æ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫:  
- **–†–µ–∑–∫–æ–º—É —Ä–æ—Å—Ç—É –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ –ë–î –∏–ª–∏ –±—ç–∫–µ–Ω–¥** (—Ç–∞–∫ –∫–∞–∫ –≤—Å–µ –∑–∞–ø—Ä–æ—Å—ã –≤—ã—á–∏—Å–ª—è—é—Ç –æ–¥–Ω–æ –∏ —Ç–æ –∂–µ)  
- **–ó–∞–º–µ–¥–ª–µ–Ω–∏—é –æ—Ç–≤–µ—Ç–æ–≤** (–∏–∑-–∑–∞ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ü–∏–∏ –∑–∞ —Ä–µ—Å—É—Ä—Å—ã)  
- **–ö–∞—Å–∫–∞–¥–Ω—ã–º –æ—Ç–∫–∞–∑–∞–º** (–µ—Å–ª–∏ —Å–µ—Ä–≤–µ—Ä –Ω–µ —Å–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —Å –Ω–∞–≥—Ä—É–∑–∫–æ–π)  

---

## üî• **–ö–∞–∫ –≤–æ–∑–Ω–∏–∫–∞–µ—Ç Cache Stampede?**  
1. **–î–∞–Ω–Ω—ã–µ –≤ –∫—ç—à–µ –∏—Å—Ç–µ–∫–∞—é—Ç** (TTL –∑–∞–∫–æ–Ω—á–∏–ª—Å—è –∏–ª–∏ –∫—ç—à –æ—á–∏—â–µ–Ω).  
2. **–ú–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–æ–≤ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ** –ø—ã—Ç–∞—é—Ç—Å—è –ø–æ–ª—É—á–∏—Ç—å —ç—Ç–∏ –¥–∞–Ω–Ω—ã–µ.  
3. **–ö–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å –≤–∏–¥–∏—Ç, —á—Ç–æ –∫—ç—à –ø—É—Å—Ç** –∏ –Ω–∞—á–∏–Ω–∞–µ—Ç –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ.  
4. **–°–∏—Å—Ç–µ–º–∞ –ø–µ—Ä–µ–≥—Ä—É–∂–∞–µ—Ç—Å—è**, —Ç–∞–∫ –∫–∞–∫ –≤–º–µ—Å—Ç–æ –æ–¥–Ω–æ–≥–æ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç N –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö.  

### –ü—Ä–∏–º–µ—Ä:  
–î–æ–ø—É—Å—Ç–∏–º, **10 000 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π** –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –æ—Ç–∫—Ä—ã–≤–∞—é—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—É, –¥–∞–Ω–Ω—ã–µ –∫–æ—Ç–æ—Ä–æ–π —Ç–æ–ª—å–∫–æ —á—Ç–æ –ø—Ä–æ—Ç—É—Ö–ª–∏ –≤ –∫—ç—à–µ. –í–º–µ—Å—Ç–æ –æ–¥–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞ –≤ –ë–î —Å–∏—Å—Ç–µ–º–∞ –¥–µ–ª–∞–µ—Ç **10 000 –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤** ‚Üí –ë–î –ø–∞–¥–∞–µ—Ç.  

---

## üõ° **–ö–∞–∫ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—Ç–∏—Ç—å Cache Stampede?**  

### 1. **Locking (–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏)**  
- –ü–µ—Ä–≤—ã–π –∑–∞–ø—Ä–æ—Å —Å—Ç–∞–≤–∏—Ç **–ª–æ–∫ (–º—å—é—Ç–µ–∫—Å)** –∏ –Ω–∞—á–∏–Ω–∞–µ—Ç –ø–µ—Ä–µ—Å—á—ë—Ç.  
- –û—Å—Ç–∞–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã **–∂–¥—É—Ç**, –ø–æ–∫–∞ –¥–∞–Ω–Ω—ã–µ –æ–±–Ω–æ–≤—è—Ç—Å—è.  
- –ü—Ä–∏–º–µ—Ä: `Redis` + `SETNX` (distributed lock).  

```python
def get_data(key):
    data = cache.get(key)
    if data is None:
        # –ü—ã—Ç–∞–µ–º—Å—è –∑–∞–ª–æ—á–∏—Ç—å –∫–ª—é—á
        lock_acquired = cache.setnx(f"lock:{key}", "1", timeout=5)
        if lock_acquired:
            try:
                data = fetch_from_db(key)  # –î–æ–ª–≥–∏–π –∑–∞–ø—Ä–æ—Å
                cache.set(key, data, ttl=60)
            finally:
                cache.delete(f"lock:{key}")
        else:
            # –ñ–¥—ë–º, –ø–æ–∫–∞ –¥—Ä—É–≥–æ–π –ø–æ—Ç–æ–∫ –æ–±–Ω–æ–≤–∏—Ç –∫—ç—à
            time.sleep(0.1)
            return get_data(key)  # –†–µ–∫—É—Ä—Å–∏–≤–Ω—ã–π retry
    return data
```

### 2. **–ü—Ä–æ–¥–ª–µ–Ω–∏–µ TTL + "–ª–µ–Ω–∏–≤–æ–µ" –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ**  
- –û–±–Ω–æ–≤–ª—è—Ç—å –∫—ç—à **–¥–æ –∏—Å—Ç–µ—á–µ–Ω–∏—è —Å—Ä–æ–∫–∞**, –ø–æ–∫–∞ –µ–≥–æ –µ—â—ë —á–∏—Ç–∞—é—Ç.  
- –ò–ª–∏ **–≤–æ–∑–≤—Ä–∞—â–∞—Ç—å —É—Å—Ç–∞—Ä–µ–≤—à–∏–µ –¥–∞–Ω–Ω—ã–µ**, –Ω–æ —Ñ–æ–Ω–æ–≤–æ –æ–±–Ω–æ–≤–ª—è—Ç—å –∏—Ö.  

### 3. **Jitter (—Ä–∞–Ω–¥–æ–º–∏–∑–∞—Ü–∏—è TTL)**  
- –î–æ–±–∞–≤–ª—è—Ç—å **—Å–ª—É—á–∞–π–Ω—É—é –∑–∞–¥–µ—Ä–∂–∫—É** –∫ —Å—Ä–æ–∫—É –∂–∏–∑–Ω–∏ –∫—ç—à–∞, —á—Ç–æ–±—ã –¥–∞–Ω–Ω—ã–µ –∏—Å—Ç–µ–∫–∞–ª–∏ –Ω–µ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ.  
- –ù–∞–ø—Ä–∏–º–µ—Ä: `TTL = 60 + rand(0, 10)` —Å–µ–∫—É–Ω–¥.  

### 4. **Two-layer caching (–¥–≤—É—Ö—É—Ä–æ–≤–Ω–µ–≤—ã–π –∫—ç—à)**  
- **L1 (–±—ã—Å—Ç—Ä—ã–π, –∫–æ—Ä–æ—Ç–∫–∏–π TTL)**: Memcached/Redis.  
- **L2 (–º–µ–¥–ª–µ–Ω–Ω—ã–π, –¥–æ–ª–≥–∏–π TTL)**: –î–∏—Å–∫ –∏–ª–∏ –±–æ–ª–µ–µ —É—Å—Ç–æ–π—á–∏–≤–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ.  
- –ï—Å–ª–∏ L1 –ø—Ä–æ—Ç—É—Ö, –∑–∞–ø—Ä–æ—Å –∏–¥—ë—Ç –≤ L2, –∞ –Ω–µ –≤ –ë–î.  

### 5. **Background Refresh (–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤ —Ñ–æ–Ω–µ)**  
- –û—Ç–¥–µ–ª—å–Ω—ã–π –≤–æ—Ä–∫–µ—Ä **–∑–∞—Ä–∞–Ω–µ–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç** –∫–ª—é—á–∏ –¥–æ –∏—Ö –∏—Å—Ç–µ—á–µ–Ω–∏—è.  

---

## üèÅ **–í—ã–≤–æ–¥**  
Cache Stampede ‚Äî –æ–ø–∞—Å–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞ –≤ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã—Ö —Å–∏—Å—Ç–µ–º–∞—Ö, –∫–æ—Ç–æ—Ä–∞—è –º–æ–∂–µ—Ç **–æ–±—Ä—É—à–∏—Ç—å –ë–î** –∏–∑-–∑–∞ –ª–∞–≤–∏–Ω—ã –∑–∞–ø—Ä–æ—Å–æ–≤. –†–µ—à–µ–Ω–∏—è:  
‚úÖ **–õ–æ–∫–∏** (—á—Ç–æ–±—ã —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω –∑–∞–ø—Ä–æ—Å –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–ª –¥–∞–Ω–Ω—ã–µ)  
‚úÖ **Jitter** (—Ä–∞–∑–Ω–µ—Å—Ç–∏ —Å—Ä–æ–∫–∏ –∏—Å—Ç–µ—á–µ–Ω–∏—è –∫—ç—à–∞)  
‚úÖ **–§–æ–Ω–æ–≤–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ** (–ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞—Ç—å cache miss)  
‚úÖ **Two-layer caching** (—Ä–µ–∑–µ—Ä–≤–Ω—ã–π –∫—ç—à)  

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ **Redis, Memcached, CDN, –±–∞–∑–∞—Ö –¥–∞–Ω–Ω—ã—Ö** –∏ –≤—ã—Å–æ–∫–æ–Ω–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è—Ö.
