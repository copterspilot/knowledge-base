## **Sequence Diagram: Распределенный мьютекс в Redis**

### **Этап 1: Захват мьютекса первым клиентом**
1. **Client A** отправляет команду `SET lock:order:12345 "ClientA" NX EX 30`
2. **Redis** возвращает `true` - мьютекс успешно захвачен
3. **Client A** начинает обработку заказа #12345
4. **Shared Resource** активируется для обработки

### **Этап 2: Попытка захвата вторым клиентом**
5. **Client B** отправляет команду `SET lock:order:12345 "ClientB" NX EX 30`
6. **Redis** возвращает `false` - мьютекс уже занят
7. **Client B** получает уведомление о занятости мьютекса

### **Этап 3: Retry логика второго клиента**
8. **Client B** начинает цикл периодических попыток
9. Каждые 100ms **Client B** повторяет команду `SET`
10. **Redis** продолжает возвращать `false` до освобождения мьютекса

### **Этап 4: Освобождение мьютекса первым клиентом**
11. **Client A** завершает обработку заказа
12. **Shared Resource** деактивируется
13. **Client A** отправляет безопасную команду освобождения мьютекса
14. **Redis** удаляет ключ и возвращает `1` - успешно удалено

### **Этап 5: Захват мьютекса вторым клиентом**
15. **Client B** отправляет команду `SET lock:order:12345 "ClientB" NX EX 30`
16. **Redis** возвращает `true` - мьютекс теперь свободен
17. **Client B** успешно захватывает мьютекс
18. **Client B** начинает обработку заказа #12345
19. **Shared Resource** активируется для обработки
20. **Client B** завершает обработку и освобождает мьютекс

---

## **Ключевые принципы:**
- ✅ **Атомарность:** Использование `NX` для гарантии единовременного захвата
- ✅ **Безопасность:** TTL предотвращает блокировку навсегда
- ✅ **Идемпотентность:** Повторные попытки не вызывают побочных эффектов
- ✅ **Отказоустойчивость:** Автоматическое освобождение при сбоях