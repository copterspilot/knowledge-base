## üéØ **1. Sequence Diagram (–î–∏–∞–≥—Ä–∞–º–º–∞ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏)**

```plantuml
@startuml
title Distributed Mutex Pattern with Redis

actor "Client A" as ClientA
actor "Client B" as ClientB
participant "Redis Server" as Redis
database "Shared Resource" as Resource

note over ClientA, Resource: –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–π –º—å—é—Ç–µ–∫—Å –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–∫–∞–∑–∞ #12345

ClientA->Redis: SET lock:order:12345 "ClientA" NX EX 30
Redis-->ClientA: OK (true)
ClientA->ClientA: –ó–∞—Ö–≤–∞—Ç –º—å—é—Ç–µ–∫—Å–∞ —É—Å–ø–µ—à–µ–Ω
ClientA->Resource: –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–∫–∞–∑–∞ #12345
activate Resource

ClientB->Redis: SET lock:order:12345 "ClientB" NX EX 30
Redis-->ClientB: NIL (false)
ClientB->ClientB: –ú—å—é—Ç–µ–∫—Å –∑–∞–Ω—è—Ç, –æ–∂–∏–¥–∞–Ω–∏–µ...

note over ClientB: –†–µ–∞–ª–∏–∑–∞—Ü–∏—è retry –ª–æ–≥–∏–∫–∏
loop –ö–∞–∂–¥—ã–µ 100ms
    ClientB->Redis: SET lock:order:12345 "ClientB" NX EX 30
    Redis-->ClientB: NIL (false)
end

ClientA->Resource: –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏
deactivate Resource
ClientA->Redis: EVAL script lock:order:12345 ClientA
Redis-->ClientA: 1 (—É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω–æ)

ClientB->Redis: SET lock:order:12345 "ClientB" NX EX 30
Redis-->ClientB: OK (true)
ClientB->ClientB: –ó–∞—Ö–≤–∞—Ç –º—å—é—Ç–µ–∫—Å–∞ —É—Å–ø–µ—à–µ–Ω
ClientB->Resource: –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–∫–∞–∑–∞ #12345
activate Resource
ClientB->Redis: EVAL script lock:order:12345 ClientB
Redis-->ClientB: 1 (—É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω–æ)
ClientB->Resource: –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏
deactivate Resource

@enduml
```

## üèóÔ∏è **2. Class Diagram (–î–∏–∞–≥—Ä–∞–º–º–∞ –∫–ª–∞—Å—Å–æ–≤)**

```plantuml
@startuml
class RedisClient {
    +StringSetAsync(key, value, expiry, when)
    +StringGetAsync(key)
    +ScriptEvaluateAsync(script, keys, values)
    +KeyDeleteAsync(key)
}

class DistributedMutex {
    -_redis: RedisClient
    -_resourceKey: string
    -_lockValue: string
    -_expiry: TimeSpan
    +AcquireAsync() bool
    +ReleaseAsync() bool
    +ExtendAsync() bool
    +AcquireWithRetryAsync(maxRetries) bool
}

class MutexResult {
    +IsAcquired: bool
    +LockValue: string
    +Expiry: DateTime
}

class RedisMutexManager {
    +CreateMutex(resource) DistributedMutex
    +TryAcquire(resource) MutexResult
    +Release(mutex) bool
    +MonitorLocks() Dictionary<String, MutexInfo>
}

class MutexInfo {
    +Resource: string
    +Owner: string
    +AcquiredAt: DateTime
    +ExpiresAt: DateTime
    +TTL: TimeSpan
}

DistributedMutex --> RedisClient : –∏—Å–ø–æ–ª—å–∑—É–µ—Ç
DistributedMutex --> MutexResult : –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç
RedisMutexManager --> DistributedMutex : —Å–æ–∑–¥–∞–µ—Ç
RedisMutexManager --> MutexInfo : –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
@enduml
```

## üîÑ **3. Activity Diagram (–î–∏–∞–≥—Ä–∞–º–º–∞ –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏)**

```plantuml
@startuml
title –ó–∞—Ö–≤–∞—Ç —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–≥–æ –º—å—é—Ç–µ–∫—Å–∞

start
:–°–æ–∑–¥–∞–Ω–∏–µ —É–Ω–∏–∫–∞–ª—å–Ω–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è;
:–§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–ª—é—á–∞ –º—å—é—Ç–µ–∫—Å–∞;
:–ü–æ–ø—ã—Ç–∫–∞ SET —Å NX –∏ EX;
if (–£—Å–ø–µ—à–Ω–æ?) then (–î–∞)
    :–ó–∞—Ö–≤–∞—Ç –º—å—é—Ç–µ–∫—Å–∞ —É—Å–ø–µ—à–µ–Ω;
    :–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–π —Å–µ–∫—Ü–∏–∏;
    :–ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ;
    stop
else (–ù–µ—Ç)
    if (Retry?) then (–î–∞)
        :–ó–∞–¥–µ—Ä–∂–∫–∞ (—ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è);
        :–ü–æ–ø—ã—Ç–∫–∞ SET —Å NX –∏ EX;
    else (–ù–µ—Ç)
        :–û—à–∏–±–∫–∞: –º—å—é—Ç–µ–∫—Å –∑–∞–Ω—è—Ç;
        stop
    endif
endif

note right
    SET lock:resource "value" NX EX 30
    –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç true –µ—Å–ª–∏ —É—Å–ø–µ—à–Ω–æ
end note

note right
    EVAL "if GET key == value then DEL key"
end note
@enduml
```

## üìä **4. Component Diagram (–î–∏–∞–≥—Ä–∞–º–º–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤)**

```plantuml
@startuml
package "–ö–ª–∏–µ–Ω—Ç—Å–∫–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è" {
    [–ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å 1] as MS1
    [–ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å 2] as MS2
    [–ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å N] as MSN
}

package "Redis Cluster" {
    [Redis Master] as Master
    [Redis Slave 1] as Slave1
    [Redis Slave 2] as Slave2
    [Redis Sentinel] as Sentinel
}

package "–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥" {
    [Metrics Collector] as Metrics
    [Alerting System] as Alerting
}

package "–£—Ç–∏–ª–∏—Ç—ã" {
    [Mutex Manager] as Manager
    [Health Checker] as Health
}

MS1 --> Master : –ó–∞—Ö–≤–∞—Ç/–æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ –º—å—é—Ç–µ–∫—Å–∞
MS2 --> Master : –ó–∞—Ö–≤–∞—Ç/–æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ –º—å—é—Ç–µ–∫—Å–∞
MSN --> Master : –ó–∞—Ö–≤–∞—Ç/–æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ –º—å—é—Ç–µ–∫—Å–∞

Master --> Slave1 : –†–µ–ø–ª–∏–∫–∞—Ü–∏—è
Master --> Slave2 : –†–µ–ø–ª–∏–∫–∞—Ü–∏—è
Sentinel --> Master : –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
Sentinel --> Slave1 : –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
Sentinel --> Slave2 : –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

Manager --> Master : –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º—å—é—Ç–µ–∫—Å–∞–º–∏
Health --> Master : –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è
Metrics --> Master : –°–±–æ—Ä –º–µ—Ç—Ä–∏–∫
Metrics --> Alerting : –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

note top of Redis Cluster
    Redis Sentinel –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç
    –≤—ã—Å–æ–∫—É—é –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –º—å—é—Ç–µ–∫—Å–æ–≤
end note
@enduml
```

## üéØ **5. State Machine Diagram (–î–∏–∞–≥—Ä–∞–º–º–∞ —Å–æ—Å—Ç–æ—è–Ω–∏–π)**

```plantuml
@startuml
[*] --> Available
Available --> Acquired: SET NX successful
Acquired --> Available: DEL successful
Acquired --> Expired: TTL reached
Expired --> Available: Automatic cleanup

state Acquired {
    [*] --> Held
    Held --> Extended: PEXPIRE renewal
    Extended --> Held
    Held --> Released: Manual release
}

note right of Available
    –ú—å—é—Ç–µ–∫—Å —Å–≤–æ–±–æ–¥–µ–Ω
    –ö—Ç–æ-—Ç–æ –º–æ–∂–µ—Ç –∑–∞—Ö–≤–∞—Ç–∏—Ç—å
end note

note right of Acquired
    –ú—å—é—Ç–µ–∫—Å –∑–∞—Ö–≤–∞—á–µ–Ω
    –¢–æ–ª—å–∫–æ –≤–ª–∞–¥–µ–ª–µ—Ü –º–æ–∂–µ—Ç –æ—Å–≤–æ–±–æ–¥–∏—Ç—å
end note

note right of Expired
    TTL –∏—Å—Ç–µ–∫
    –ú—å—é—Ç–µ–∫—Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω
end note
@enduml
```

## üìù **–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –≤ Obsidian:**

1. **–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø–ª–∞–≥–∏–Ω PlantUML** –≤ Obsidian
2. **–°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π —Ñ–∞–π–ª** —Å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ–º `.md`
3. **–í—Å—Ç–∞–≤—å—Ç–µ –∫–æ–¥ –¥–∏–∞–≥—Ä–∞–º–º—ã** –º–µ–∂–¥—É —Ç–µ–≥–∞–º–∏:
   ````
   ```plantuml
   @startuml
   // –ö–æ–¥ –¥–∏–∞–≥—Ä–∞–º–º—ã –∑–¥–µ—Å—å
   @enduml
   ```
   ````
4. **–°–æ—Ö—Ä–∞–Ω–∏—Ç–µ —Ñ–∞–π–ª** - –¥–∏–∞–≥—Ä–∞–º–º–∞ –æ—Ç–æ–±—Ä–∞–∑–∏—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

## üéØ **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:**

- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã –¥–ª—è –∫–∞–∂–¥–æ–π –¥–∏–∞–≥—Ä–∞–º–º—ã
- –î–æ–±–∞–≤—å—Ç–µ –ø–æ—è—Å–Ω—è—é—â–∏–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏ –∏ –æ–ø–∏—Å–∞–Ω–∏—è
- –ù–∞—Å—Ç—Ä–æ–π—Ç–µ —Ç–µ–º—É PlantUML –¥–ª—è –ª—É—á—à–µ–π —á–∏—Ç–∞–µ–º–æ—Å—Ç–∏
- –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ –¥–∏–∞–≥—Ä–∞–º–º—ã –≤ PNG/PDF –¥–ª—è –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–π

–≠—Ç–∏ –¥–∏–∞–≥—Ä–∞–º–º—ã –≥–æ—Ç–æ–≤—ã –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –≤ Obsidian –∏ –Ω–∞–≥–ª—è–¥–Ω–æ –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É—é—Ç –≤—Å–µ –∞—Å–ø–µ–∫—Ç—ã —Ä–∞–±–æ—Ç—ã —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–≥–æ –º—å—é—Ç–µ–∫—Å–∞ –≤ Redis!