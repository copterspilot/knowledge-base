## üîê **PKCE (Proof Key for Code Exchange)**

**PKCE** (–ø—Ä–æ–∏–∑–Ω–æ—Å–∏—Ç—Å—è –∫–∞–∫ "pixie") ‚Äî —ç—Ç–æ **—Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ –ø—Ä–æ—Ç–æ–∫–æ–ª–∞ OAuth 2.0**, —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–Ω–Ω–æ–µ –¥–ª—è **–ø–æ–≤—ã—à–µ–Ω–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏** –≤ —Å—Ü–µ–Ω–∞—Ä–∏—è—Ö –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏, –æ—Å–æ–±–µ–Ω–Ω–æ –¥–ª—è **–ø—É–±–ª–∏—á–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤** (–º–æ–±–∏–ª—å–Ω—ã—Ö –∏ –æ–¥–Ω–æ—Å—Ç—Ä–∞–Ω–∏—á–Ω—ã—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π).

---

## üéØ **–û—Å–Ω–æ–≤–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞, –∫–æ—Ç–æ—Ä—É—é —Ä–µ—à–∞–µ—Ç PKCE:**

### **–ê—Ç–∞–∫–∞ –ø–µ—Ä–µ—Ö–≤–∞—Ç–∞ Authorization Code**
–í —Ç—Ä–∞–¥–∏—Ü–∏–æ–Ω–Ω–æ–º OAuth 2.0:
1. –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø–æ–ª—É—á–∞–µ—Ç `authorization code`
2. –û–±–º–µ–Ω–∏–≤–∞–µ—Ç –µ–≥–æ –Ω–∞ `access token`
3. **–ü—Ä–æ–±–ª–µ–º–∞**: `authorization code` –º–æ–∂–µ—Ç –±—ã—Ç—å –ø–µ—Ä–µ—Ö–≤–∞—á–µ–Ω –≤ –Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã—Ö –∫–∞–Ω–∞–ª–∞—Ö

---

## üîß **–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç PKCE:**

### **1. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–æ–¥–∞:**
```
code_verifier = —Å–ª—É—á–∞–π–Ω–∞—è —Å—Ç—Ä–æ–∫–∞ (43-128 —Å–∏–º–≤–æ–ª–æ–≤)
code_challenge = BASE64URL-ENCODE(SHA256(code_verifier))
```

### **2. Authorization Request:**
```
GET /authorize?
  client_id=...
  code_challenge=... (—Ö—ç—à)
  code_challenge_method=S256
  redirect_uri=...
  response_type=code
  scope=...
```

### **3. Token Request:**
```
POST /token
  grant_type=authorization_code
  code=...
  redirect_uri=...
  code_verifier=... (–æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–∞—è —Å—Ç—Ä–æ–∫–∞)
```

---

## üìã **–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ PKCE:**

‚úÖ **–ó–∞—â–∏—Ç–∞ –æ—Ç –ø–µ—Ä–µ—Ö–≤–∞—Ç–∞ authorization code**  
‚úÖ **–ù–µ —Ç—Ä–µ–±—É–µ—Ç shared secret** (–ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –ø—É–±–ª–∏—á–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤)  
‚úÖ **–°—Ç–∞–Ω–¥–∞—Ä—Ç RFC 7636**  
‚úÖ **–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ–º –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤** (Google, Microsoft, Auth0, Okta)  
‚úÖ **–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–ª—è Native Apps** (–ø–æ RFC 8252)

---

## üì± **–ì–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è PKCE:**

### **1. –ú–æ–±–∏–ª—å–Ω—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è**
- –ù–µ—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –º–µ—Å—Ç–∞ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è client_secret
- Redirect URI –º–æ–∂–µ—Ç –±—ã—Ç—å –ø–µ—Ä–µ—Ö–≤–∞—á–µ–Ω

### **2. SPA (Single Page Applications)**
- JavaScript –≤ –±—Ä–∞—É–∑–µ—Ä–µ
- –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ —Å–∫—Ä—ã—Ç—å client_secret

### **3. Desktop –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è**
- –ù–µ—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ –¥–ª—è —Å–µ–∫—Ä–µ—Ç–æ–≤

---

## üîÅ **–ü–æ—Ç–æ–∫ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ —Å PKCE:**

```mermaid
sequenceDiagram
    participant User
    participant Client
    participant AuthServer

    Client->>Client: –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç code_verifier<br/>–∏ code_challenge
    Client->>AuthServer: Authorization Request<br/>+ code_challenge
    AuthServer->>User: Redirect to login
    User->>AuthServer: –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
    AuthServer->>Client: Authorization Code
    Client->>AuthServer: Token Request<br/>+ code_verifier
    AuthServer->>Client: Access Token
```

---

## üõ°Ô∏è **–ü—Ä–∏–º–µ—Ä —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ (Node.js):**

```javascript
const crypto = require('crypto');

// 1. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è code_verifier
const code_verifier = base64URLEncode(crypto.randomBytes(32));

// 2. –°–æ–∑–¥–∞–Ω–∏–µ code_challenge
const code_challenge = base64URLEncode(
  crypto.createHash('sha256')
    .update(code_verifier)
    .digest()
);

// 3. Authorization Request
const authUrl = `https://auth.example.com/authorize?
  client_id=...
  code_challenge=${code_challenge}
  code_challenge_method=S256
  response_type=code`;
```

---

## üìö **–°—Ç–∞–Ω–¥–∞—Ä—Ç—ã:**

- **RFC 7636** - PKCE specification
- **RFC 8252** - OAuth 2.0 for Native Apps (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç PKCE)
- **OAuth 2.1** - PKCE —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–º

---

## ‚úÖ **–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å PKCE:**

- **–í—Å–µ–≥–¥–∞** –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö –∏ desktop –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π  
- **–í—Å–µ–≥–¥–∞** –¥–ª—è SPA –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π  
- **–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è** –¥–ª—è –≤—Å–µ—Ö –ø—É–±–ª–∏—á–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤  
- **–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ** –ø–æ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞–º –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

PKCE ‚Äî —ç—Ç–æ **best practice** –¥–ª—è —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–π OAuth 2.0 –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏!