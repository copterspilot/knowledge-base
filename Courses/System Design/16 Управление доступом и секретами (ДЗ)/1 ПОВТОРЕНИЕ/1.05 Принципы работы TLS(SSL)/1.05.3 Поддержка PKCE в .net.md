–í .NET –ø–æ–¥–¥–µ—Ä–∂–∫–∞ PKCE (Proof Key for Code Exchange) —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —á–µ—Ä–µ–∑ –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ —Å—Ä–µ–¥—Å—Ç–≤–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∏ –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –∫–∞–∫ –≤ —Å–µ—Ä–≤–µ—Ä–Ω—ã—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è—Ö (ASP.NET Core), —Ç–∞–∫ –∏ –≤ –∫–ª–∏–µ–Ω—Ç—Å–∫–∏—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è—Ö (.NET MAUI, WPF, WinForms).

## üîß **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è PKCE –≤ .NET**

### **1. –í ASP.NET Core (—Å–µ—Ä–≤–µ—Ä–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ):**

```csharp
// Program.cs - –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ OpenID Connect —Å PKCE
builder.Services.AddAuthentication(options =>
{
    options.DefaultScheme = CookieAuthenticationDefaults.AuthenticationScheme;
    options.DefaultChallengeScheme = OpenIdConnectDefaults.AuthenticationScheme;
})
.AddCookie()
.AddOpenIdConnect(options =>
{
    options.Authority = "https://your-identity-provider";
    options.ClientId = "your-client-id";
    options.ClientSecret = "your-client-secret"; // –î–ª—è confidential clients
    options.ResponseType = "code";
    options.Scope.Add("openid");
    options.Scope.Add("profile");
    
    // –í–∫–ª—é—á–µ–Ω–∏–µ PKCE
    options.UsePkce = true;
    
    // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
    options.SaveTokens = true;
    options.GetClaimsFromUserInfoEndpoint = true;
});
```

### **2. –í –∫–ª–∏–µ–Ω—Ç—Å–∫–∏—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è—Ö (.NET 6+):**

```csharp
using IdentityModel.Client;

// –°–æ–∑–¥–∞–Ω–∏–µ PKCE –¥–∞–Ω–Ω—ã—Ö
var pkce = CryptoHelper.CreatePkceData();

// –ó–∞–ø—Ä–æ—Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ —Å PKCE
var startUrl = new RequestUrl("https://identity-server/connect/authorize")
    .CreateAuthorizeUrl(
        clientId: "interactive.public",
        responseType: "code",
        redirectUri: "https://localhost:5001/signin-oidc",
        scope: "openid profile api1",
        codeChallenge: pkce.CodeChallenge,
        codeChallengeMethod: OidcConstants.CodeChallengeMethods.Sha256);

// –û–±–º–µ–Ω –∫–æ–¥–∞ –Ω–∞ —Ç–æ–∫–µ–Ω —Å PKCE
var response = await httpClient.RequestAuthorizationCodeTokenAsync(new AuthorizationCodeTokenRequest
{
    Address = "https://identity-server/connect/token",
    ClientId = "interactive.public",
    Code = code,
    CodeVerifier = pkce.CodeVerifier,
    RedirectUri = "https://localhost:5001/signin-oidc"
});
```

### **3. –í .NET MAUI (–º–æ–±–∏–ª—å–Ω—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è):**

```csharp
// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ WebAuthenticator —Å PKCE
private async Task<string> AuthenticateAsync()
{
    WebAuthenticatorOptions webAuthenticatorOptions = new()
    {
        Url = new Uri($"{authority}/connect/authorize"),
        CallbackUrl = new Uri("myapp://callback"),
        PrefersEphemeralWebBrowserSession = true
    };

    try
    {
        WebAuthenticatorResult result = await WebAuthenticator.Default.AuthenticateAsync(webAuthenticatorOptions);
        
        // PKCE –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
        var code = result.Properties["code"];
        return code;
    }
    catch (TaskCanceledException)
    {
        // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–º–µ–Ω–∏–ª –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é
        return null;
    }
}
```

## üõ°Ô∏è **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ PKCE:**

### **–í ASP.NET Core Identity:**
```csharp
// –ü—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ AddMicrosoftIdentityWebApp
builder.Services.AddMicrosoftIdentityWebAppAuthentication(Configuration)
    .EnableTokenAcquisitionToCallDownstreamApi()
    .AddInMemoryTokenCaches();

// PKCE –≤–∫–ª—é—á–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–ª—è public clients
```

### **–í Blazor WebAssembly:**
```csharp
// Program.cs
builder.Services.AddOidcAuthentication(options =>
{
    builder.Configuration.Bind("Local", options.ProviderOptions);
    // PKCE –≤–∫–ª—é—á–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
});
```

## ‚öôÔ∏è **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ —á–µ—Ä–µ–∑ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é:**

```json
// appsettings.json
{
  "AzureAd": {
    "Instance": "https://login.microsoftonline.com/",
    "Domain": "yourdomain.onmicrosoft.com",
    "TenantId": "your-tenant-id",
    "ClientId": "your-client-id",
    "CallbackPath": "/signin-oidc",
    "ResponseType": "code"
  }
}
```

## üéØ **–ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –≤ .NET:**

1. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è PKCE** - .NET –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç code_verifier –∏ code_challenge
2. **–í—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞** - PKCE –≤–∫–ª—é—á–∞–µ—Ç—Å—è –æ–¥–Ω–∏–º —Ñ–ª–∞–≥–æ–º `UsePkce = true`
3. **–ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ç–∏–ø–æ–≤ –∫–ª–∏–µ–Ω—Ç–æ–≤** - –∫–∞–∫ confidential, —Ç–∞–∫ –∏ public clients
4. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å IdentityServer** - –Ω–∞—Ç–∏–≤–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤
5. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ** - code_verifier —Ö—Ä–∞–Ω–∏—Ç—Å—è –±–µ–∑–æ–ø–∞—Å–Ω–æ –≤ –ø–∞–º—è—Ç–∏

## üìä **–ü—Ä–æ–≤–µ—Ä–∫–∞ PKCE:**

```csharp
// Middleware –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è OAuth –∑–∞–ø—Ä–æ—Å–æ–≤
app.Use(async (context, next) =>
{
    if (context.Request.Path.StartsWithSegments("/signin-oidc"))
    {
        // –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ PKCE
        var codeVerifier = context.Request.Form["code_verifier"];
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è PKCE –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
    }
    await next();
});
```
