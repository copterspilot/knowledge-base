### **Что такое Threat Modeling?**

**Threat Modeling (Моделирование угроз)** - это **систематический процесс** выявления, оценки и определения приоритетов потенциальных **угроз** для информационной системы. Это **проактивный подход** к обеспечению безопасности, который позволяет **предвидеть риски** на ранних стадиях проектирования (в контексте System Design) и **внедрять меры защиты** до того, как система будет реализована.

Цель моделирования угроз - **понять, каким образом** злоумышленник может **навредить системе**, чтобы **предотвратить** это или **минимизировать последствия**.

---

### **Основные компоненты Threat Modeling**

1.  **Что защищаем (Asset Identification)?**
    *   Определение **ценных активов** системы: данные (персональные данные, финансовая информация, интеллектуальная собственность), функциональность, доступность, репутация.
2.  **Как защищаем (Architecture Analysis)?**
    *   Анализ архитектуры системы: выявление **компонентов** (сервисы, базы данных, API), **взаимодействий** (сетевые вызовы, потоки данных), **границ** (доверенные/недоверенные зоны), **точек входа** (endpoints).
3.  **От чего защищаем (Threat Identification)?**
    *   Использование структурированных подходов (например, **STRIDE**) для выявления потенциальных угроз.
4.  **Как защищаем эффективно (Mitigation)?**
    *   Определение и документирование мер безопасности для **смягчения** или **устранения** выявленных угроз.
5.  **Насколько защищены (Validation)?**
    *   Проверка того, что реализованные меры действительно устраняют или уменьшают риски.

---

### **Методология STRIDE (один из популярных фреймворков)**

STRIDE - это мнемоника, помогающая классифицировать угрозы:

| STRIDE | Тип угрозы | Описание | Пример в контексте системы с Vault/Keycloak |
| :--- | :--- | :--- | :--- |
| **S**poofing (Подделка идентичности) | Аутентификация | Представление себя как другой сущности | Атакующий подделывает JWT токен другого пользователя. |
| **T**ampering (Несанкционированное изменение) | Целостность | Изменение данных или кода | Изменение конфигурации сервиса в Kubernetes. |
| **R**epudiation (Отказ от действий) | Неотказуемость | Отказ пользователя от выполненного действия | Пользователь отрицает перевод денег. |
| **I**nformation Disclosure (Раскрытие информации) | Конфиденциальность | Раскрытие конфиденциальной информации неавторизованным лицам | Утечка секретов из Vault из-за неправильной конфигурации. |
| **D**enial of Service (Отказ в обслуживании) | Доступность | Лишение легитимных пользователей доступа к ресурсам | DDoS-атака на API Gateway или Vault. |
| **E**levation of Privilege (Повышение привилегий) | Авторизация | Получение прав, превышающих предоставленные | Сервис получает Vault-токен с админ-политикой вместо своей ограниченной. |

---

### **Процесс Threat Modeling (упрощенный)**

1.  **Определение целей и области моделирования:**
    *   Какую часть системы анализируем? (Всю систему? Конкретный сервис? API?)
    *   Каковы бизнес-цели и критичные активы?
2.  **Создание модели архитектуры:**
    *   Нарисовать **диаграмму данных и потоков** (Data Flow Diagram - DFD).
    *   Выделить **внешние сущности** (пользователи, внешние API), **процессы** (сервисы), **хранилища данных** (БД, Vault), **потоки данных** (HTTP-запросы, вызовы API).
3.  **Выявление и классификация угроз:**
    *   Для каждого элемента DFD задать вопросы, основанные на STRIDE или других фреймворках.
    *   Пример: "Может ли кто-то подделать данные, передаваемые от Frontend к Backend API?" (Spoofing). "Могут ли данные в PostgreSQL быть украдены?" (Information Disclosure).
4.  **Оценка и ранжирование угроз:**
    *   Оценить **вероятность** реализации угрозы и **потенциальный ущерб**.
    *   Определить приоритеты для устранения (высокая вероятность + высокий ущерб = высокий приоритет).
5.  **Определение мер противодействия (Mitigation):**
    *   Для каждой угрозы определить, как её **смягчить**, **устранить** или **передать риск** (например, через страхование).
    *   Пример: Для угрозы "Раскрытие информации (Vault secrets)" меры могут быть: использование Vault Agent Sidecar, настройка строгих политик Vault, включение аудита Vault.
6.  **Документирование и валидация:**
    *   Зафиксировать все выявленные угрозы, оценки и меры.
    *   Проверить, учтены ли ключевые аспекты безопасности, соответствует ли это теме "Безопасность и управление доступом" курса System Design.

---

### **Пример Threat Modeling для системы с Vault/Keycloak (фрагмент)**

**Компонент:** Взаимодействие Backend API с HashiCorp Vault для получения секретов.

**Поток данных:** Backend API -> (HTTP-запрос) -> Vault API

**Угрозы (STRIDE):**

1.  **Spoofing:** Атакующий может подделать запрос к Vault, выдавая себя за Backend API.
    *   **Митигация:** Использовать строгую аутентификацию Vault (например, `kubernetes` Auth Method с JWT ServiceAccount), применение mTLS между сервисами (например, через Istio).
2.  **Tampering:** Трафик между Backend API и Vault может быть изменен.
    *   **Митигация:** Обязательное использование TLS (лучше всего TLS 1.3 с PFS) для всех внутренних вызовов.
3.  **Information Disclosure:** Секреты, полученные из Vault, могут быть перехвачены или записаны в логи.
    *   **Митигация:** Никогда не логировать секреты, использовать Vault Agent Sidecar для изоляции секретов от основного процесса приложения, ограничить права Vault-токена (принцип наименьших привилегий).
4.  **Denial of Service:** Атакующий может отправить множество запросов к Vault, исчерпав его ресурсы или квоты Backend API.
    *   **Митигация:** Настроить Rate Limiting на уровне Vault и/или API Gateway, использовать резервирование и масштабирование Vault.
5.  **Elevation of Privilege:** Backend API может получить Vault-токен с чрезмерными правами.
    *   **Митигация:** Тщательно настраивать Vault Policies и Role Bindings, использовать принцип наименьших привилегий.

---

Threat Modeling - это **критически важный элемент** темы **"Безопасность и управление доступом"** курса System Design. Он позволяет:

*   **Проактивно** подходить к безопасности на этапе **проектирования**, а не после реализации.
*   **Структурировать** мышление об угрозах, используя фреймворки типа STRIDE.
*   **Интегрировать** конкретные меры безопасности (TLS, Vault Policies, Auth Methods, логирование) в архитектуру системы.
*   **Демонстрировать** понимание того, **почему** выбираются те или иные технологии (например, Vault для управления секретами помогает смягчить угрозу раскрытия информации).
*   **Создать** основу для **мониторинга и аудита**, определив, какие события безопасности нужно отслеживать.

В домашнем задании по проектированию безопасной системы Threat Modeling может быть неявно представлен как **основа**, на которой строятся решения по аутентификации, шифрованию, управлению доступом и секретам. Явное упоминание и применение этого процесса (пусть даже в упрощенном виде) значительно повысит качество выполнения задания по критериям "Глубина проработки аспектов безопасности" и "Обоснованность выбора технологий".