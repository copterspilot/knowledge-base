# **Многоуровневая защита сети в Google Cloud: Полное руководство**

## **1. Микросегментация доступа к приложениям и сервисам**

### **IAM (API-доступ)**
**Значение:** Контроль доступа к облачным ресурсам на основе принципа наименьших привилегий  
**Требования:**
- Использование предопределенных ролей (predefined roles)
- Включение MFA для административных аккаунтов
- Регулярный аудит назначенных прав

**Рекомендации:**
- Применение условий IAM (например, ограничение по IP или времени)
- Использование временных токенов вместо долгоживущих ключей
- Включение аудит-логов для всех критических операций

**Пример нарушения (2021):**  
Сотрудник назначил роль `editor` сервисному аккаунту CI/CD, который был скомпрометирован.  
**Последствия:** Злоумышленник развернул криптомайнеры, затраты $48k.  
**Решение:** Следовало использовать специализированную роль `cloudbuild.builds.editor`.

**Чек-лист:**
- [ ] Нет пользователей с примитивными ролями (owner/editor/viewer)
- [ ] Для сервисных аккаунтов применен принцип минимальных прав
- [ ] Включено логирование всех административных действий

### **Istio Security**
**Значение:** Защита сервис-сервисного взаимодействия  
**Требования:**
- Включение mTLS в режиме STRICT
- Политики авторизации "deny by default"
- Регулярное обновление sidecar-прокси

**Рекомендации:**
- Использование JWT для верификации запросов
- Изоляция namespace'ов через AuthorizationPolicy
- Мониторинг аномальных запросов

**Пример нарушения (2022):**  
Отсутствие политик позволило перемещение из скомпрометированного фронтенда в БД.  
**Последствия:** Утечка 320k записей пользователей.  
**Решение:** Требовалась политика `DENY all` с явными разрешениями.

**Чек-лист:**
- [ ] mTLS включен для всего кластера
- [ ] Настроены AuthorizationPolicy для каждого сервиса
- [ ] Регулярно сканируются конфигурации

## **2. Защита VPC для приватных сервисов**

### **VPC Service Controls**
**Значение:** Предотвращение утечки данных за пределы доверенной зоны  
**Требования:**
- Определение периметров для sensitive-проектов
- Настройка уровней доступа (Access Levels)
- Блокировка публичных API-вызовов

**Рекомендации:**
- Многоуровневая модель периметров
- Тестирование границ через Red Team
- Интеграция с DLP-системами

**Пример нарушения (2022):**  
Отсутствие периметра позволило копирование из BigQuery в публичный GCS.  
**Последствия:** Утечка PII-данных 1.4M клиентов.  
**Решение:** Требовалось настроить Service Perimeter с правилами доступа.

**Чек-лист:**
- [ ] Периметры определены для критических проектов
- [ ] Настроены алерты на попытки обхода
- [ ] Регулярно тестируются границы

## **3. Защита публично доступных приложений**

### **Cloud Armor**
**Значение:** Защита от веб-атак и DDoS  
**Требования:**
- Включение OWASP Core Rule Set
- Настройка rate limiting
- Геоблокировка опасных регионов

**Рекомендации:**
- Кастомизация правил под специфику приложения
- Использование reCAPTCHA Enterprise
- Мониторинг ложных срабатываний

**Пример нарушения (2023):**  
SQL-инъекция через незащищенный API-эндпоинт.  
**Последствия:** Компрометация CRM-системы.  
**Решение:** Требовалось включить правило `sqli-stable` в WAF.

**Чек-лист:**
- [ ] Активирован базовый набор правил OWASP
- [ ] Настроено ограничение 100 запросов/сек на IP
- [ ] Включено логирование блокировок

## **Комплексный чек-лист безопасности**

| Уровень защиты         | Критические проверки                     | Статус |
|------------------------|------------------------------------------|--------|
| **IAM**               | Нет примитивных ролей, включена MFA      | ☐      |
| **VPC SC**            | Определены периметры, нет исключений     | ☐      |
| **Cloud Armor**       | Правила OWASP, rate limiting             | ☐      |
| **TLS**               | TLS 1.2+, HSTS, валидные сертификаты    | ☐      |

**Рекомендации по внедрению:**
1. Начните с организационных политик и IAM
2. Постепенно внедряйте VPC Service Controls
3. Защитите публичные endpoints (WAF, IAP)
4. Регулярно тестируйте конфигурации через Security Command Center

**Технические спецификации:**
- Для GKE: `gcloud container clusters update --enable-network-policy`
- Для VPC SC: `gcloud access-context-manager perimeters create`
- Для Cloud Armor: `gcloud compute security-policies rules create`

Этот подход обеспечивает комплексную защиту, соответствующую требованиям CIS Google Cloud Benchmark и рекомендациям Google.
